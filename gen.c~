#include<stdio.h>
#include<stdlib.h>
#include<math.h>
#include<time.h>

typedef unsigned long int usint;

int SIZE;
int BLOCK_SIZE;
usint **a;

static int z;

void print(usint (*a)[SIZE]){
	int i, j;
	for(i = 0; i < SIZE; i++){
		for(j = 0; j< SIZE; j++){
			printf("%lu\t", a[i][j]);
		}
		printf("\n");	
	}
printf("\n");
}

usint randomize(){
	usint n;
	time_t tt;
	srandom(time(&tt));
	
	n = (usint)random()%100;
	return ((n*13)%SIZE + 1);
}

int checkrow( int i, int j, usint n){
	int c =1, m;
	for(m = 0; m < SIZE; m++){
//printf("check row m is %d n is %lu a[%d][%d] is %lu\n",m,n,i,m,a[i][m]);
		if(a[i][m] == n)
			c = 0;
	}
//printf("c is %d \n",c);
	return c;
}

int checkcol( int i, int j, usint n){
	int c =1, m;
	for(m = 0; m < SIZE; m++){
		if(a[m][j] == n)
			c = 0;
	}
//printf("c is %d \n",c);
	return c;
}

int checkblock( int i, int j, usint n){
	int c =1, m, l, x, y;
	x = i/BLOCK_SIZE;
	y = j/BLOCK_SIZE;
	for(m = 0; m < BLOCK_SIZE; m++){
		for(l = 0; l < BLOCK_SIZE; l++){
			if(a[x*BLOCK_SIZE +m][y*BLOCK_SIZE + l] == n)
				c = 0;
		}
	}
//printf("c is %d \n",c);
	return c;
}

int check(int i, int j, int n){
	return (checkrow( i, j, n) & checkcol( i, j, n) & checkblock( i, j, n));
}

usint getnext(usint (*a)[SIZE], int i, int j){
	z++;
	usint n;
	int k;
	n = randomize();
	k = check(i, j, n);
//printf("in getnext k = %d\n", k);

	if(k == 1)
		return n;
	else{
		if(z < 500)
			return getnext(a, i, j);
		else
			return 10;
	}
}

void generate(usint (*a)[SIZE]){
	int i, j;
	usint n, m;
	for(i = 0; i < SIZE; i++){
		for(j = 0; j < SIZE; j++){
			z = 0;
			if(n = getnext(a, i, j))
				a[i][j] = n;
			else{
				if(j)
					j--;
				else{
					i--;
					j = SIZE - 1;
				}
				n = getnext(a, i, j);
				while(n != a[i][j]){
					if(j)
						j--;
					else{
						if(!i)
							break;
						i--;
						j = SIZE - 1;
					}
					n = getnext(a, i, j);
				}
				a[i][j] = n;
			}
print(a);
//printf("a[%d][%d] is %lu \n", i, j, n);
		}
	}
}
	

int main(){
	SIZE = 9;
	BLOCK_SIZE = sqrt(SIZE);
	int i, j;
	a = calloc(20,sizeof(usint));
	for(i = 0; i < 20; i++)
		a[i] = calloc(20,sizeof(usint));
	generate(a);
	print(a);
	/*usint a[SIZE][SIZE];
	usint n;
	int i, j, k ;
	for(i = 0; i < SIZE; i++){
		for(j = 0; j< SIZE; j++)
			scanf("%lu", &a[i][j]);
	}
	printf("checkrow for 2,0 is %d\n", checkrow(a,2,0,SIZE));
	printf("checkcolumn for 2,0 is %d\n", checkcol(a,2,0,SIZE));
	printf("checkblock for 2,0 is %d\n", checkblock(a,2,0,SIZE));*/
/*int i, j ;
usint n;
	for(i = 0; i < SIZE; i++){
		for(j = 0; j < SIZE; j++){
			n = getnext(a,i,j);
			printf("n is %lu\n",n);
		}
	}
	*/
	return 0;
}
	







